
# Deployment README

## What this package contains
- `main.tf`, `variables.tf` - Terraform configuration to create a minimal AWS environment:
  - VPC, Subnet, Internet Gateway, Route Table
  - Security Group allowing SSH/HTTP/HTTPS
  - S3 bucket to store application archive (`app.zip`)
  - IAM Role + Instance Profile for EC2 to read from the S3 bucket
  - EC2 `t2.micro` instance with user-data to install Docker and run `docker-compose`
  - An RSA keypair generated by Terraform and exposed as a sensitive output (private key)

- `files/app.zip` - the application archive (copied from your uploaded `docker-compose.zip`)
- `user_data.tpl` - instance startup script template (Terraform will substitute the S3 bucket name)
- `deploy.sh` - a convenience script to run Terraform from your machine
- `deployment.md` - this file

## Prerequisites
- Terraform v1.2+ installed locally
- AWS credentials available in environment variables:
  - `AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY`
  - Optionally `AWS_DEFAULT_REGION` (defaults to us-east-1)
- `ssh` (for viewing keypair locally if needed)

## How to run (dry-run + apply)
1. From the package root run:
   ```bash
   export AWS_ACCESS_KEY_ID=YOURKEY
   export AWS_SECRET_ACCESS_KEY=YOURSECRET
   export AWS_DEFAULT_REGION=us-east-1

   ./deploy.sh
   ```
2. The script will run `terraform init`, `terraform plan`, and `terraform apply` (auto-approved).
3. After successful apply, it will show outputs including the instance public IP and the private key (sensitive).
4. To SSH into the instance you can do:
   ```bash
   chmod 600 deploy_key
   ssh -i deploy_key ubuntu@<INSTANCE_PUBLIC_IP>
   ```

## Notes & limitations
- This is a POC with the **least resources** (single `t2.micro` instance) and **no RDS**.
- The instance user-data expects `docker-compose.yml` at the root of the uploaded archive.
- Terraform will upload `files/app.zip` to the S3 bucket it creates. The IAM role allows the EC2 instance to read from that bucket.
- The private key is sensitive; treat it carefully.
- This environment will incur AWS charges for the EC2 instance, S3, and associated resources. Destroy the stack when done:
  ```bash
  terraform destroy -auto-approve
  ```
